---
description: 流媒体应用程序接口提供实时信息（如时间轴上的新帖子、反应、关注者等）和其他各种操作。
---

# 流媒体应用程序接口

::: tip
您应该先阅读[Ocean API 文档]（.../index.md）。
:::

流应用程序接口提供实时信息（如时间轴上的新帖子、反应、关注者等）和其他各种操作。

## 连接到流媒体。

要使用流媒体应用程序接口，必须使用**websocket**连接到 Ocean 服务器。

websocket URL 如下

```:no-line-numbers
wss://{host}/streaming?i={token}
```

其中
- `{host}`是要连接的实例的主机。
- `{token}`是用户的访问令牌。

::: tip
您也可以在没有访问令牌的情况下进行连接，但这将限制您接收的信息和执行的操作。
:::

连接到信息流后，您就可以按下文所述订阅帖子，但在此阶段您还不能接收时间轴上的新帖子。

要接收此类事件，您需要加入流上的**频道**，如下所述。

**所有数据都应编码为 JSON。

## 频道
Ocean 的流 API 有通道的概念。这是一种分离发送和接收信息的机制。
通过加入流上的通道，您将能够接收各种信息并发送信息。

::: tip
您可以在单个数据流连接上同时加入多个频道。
:::

下文将介绍如何使用这些频道。要查看可用的频道，请参阅[频道列表]（./channel/index.md）。

### 加入频道
要加入一个频道，请在数据流中发送以下 JSON 数据：

```js
{
	type: 'connect',
	body: {
		channel: 'xxxxxxxx',
		id: 'foobar',
		params: {
			...
		}
	}
}
```

where
- `channel` 通道 "是您要连接的通道名称。本节稍后将介绍通道的类型。
- `id` 是与该频道交互的任意 ID。这是识别信息来自哪个通道的必要条件，因为一个数据流包含多个通道。ID 可以是 UUID 或随机数。
- `params` 是加入通道时所需的参数。不同的频道在连接时需要不同的参数。连接到不需要参数的频道时，可以省略此属性。

::: tip
ID 不是每个通道的 ID，而是每个通道连接的 ID，因为一个通道可能需要多次使用，但参数不同。
:::

### 接收来自频道的信息
例如，时间轴频道会在有新文章发布时发送消息。收到消息后，你就能实时知道时间轴上发布了新文章。

当频道发布消息时，会发送以下 JSON 数据：
```js
{
	type: 'channel',
	body: {
		id: 'foobar',
		type: 'something',
		body: {
			some: 'thing'
		}
	}
}
```

其中
- `id` 是您在连接到上述通道时设置的 ID。这可以让您知道这条信息来自哪个通道（实例）。
- `type` 是信息的类型。发送的信息类型取决于通道。
- `body` 是信息的内容。信息内容取决于信道。

### 向通道发送信息
在某些频道上，除了接收信息外，还可以发送信息和执行其他操作。

要向通道发送信息，请向数据流发送以下 JSON 数据：
```js
{
	type: 'channel',
	body: {
		id: 'foobar',
		type: 'something',
		body: {
			some: 'thing'
		}
	}
}
```

其中
- `id` 是您在连接上述通道时设置的 ID。这可以让您确定消息是哪个通道（实例）的。
- `type` 是信息类型。不同的频道接受不同类型的信息。
- `body` 包含信息内容。不同的频道接受不同的信息内容。

### 断开与频道的连接
要断开与频道的连接（实例化），请向数据流发送以下 JSON 数据：
```js
{
	type: 'disconnect',
	body: {
		id: 'foobar'
	}
}
```

其中
- `id` 是您在连接到上述通道时设置的 ID。这样就可以确定要断开连接的通道（实例）。

## 捕捉笔记
Ocean 提供了一种名为 "笔记捕捉 "的机制。这是一种接收给定音符事件流的能力。

例如，假设您抓取了一条时间线，并将其显示给用户。假设有人对时间轴上的某个帖子做出了反应。
然而，由于客户端无法知道某条记录是否已被回应，因此无法在时间轴中实时反映回应情况。

为了解决这个问题，Ocean 提供了一个捕获备注的机制。捕获笔记后，您将收到与该笔记相关的事件，并可实时显示对该笔记的反应。

下文将介绍如何使用笔记捕捉功能。要了解可用的捕获事件类型，请参阅[捕获事件列表](./note-capture-events.md)。

### 捕获笔记

要捕获笔记，请向流发送以下 JSON 数据：

### 捕获笔记

要捕获笔记，请向流发送以下 JSON 数据：
```js
{
	type: 'subNote',
	body: {
		id: 'xxxxxxxxxxxxxxxx'
	}
}
```

其中
- `id` 是您要捕获的注释的 ID。

当您发送此消息时，您就是在请求 Ocean 捕捉该笔记，然后与该笔记相关的事件就会流式传输给您。

例如，当某个备忘得到回应时，您会看到如下信息：
```js
{
	type: 'noteUpdated',
	body: {
		id: 'xxxxxxxxxxxxxxxx',
		type: 'reacted',
		body: {
			reaction: 'like',
			userId: 'yyyyyyyyyyyyyyyy'
		}
	}
}
```

其中
- `body.id` 将设置为触发事件的帖子的 ID。
- `body.type` 将是事件的类型。
- `body.body` 将包含事件的详细信息。

### 取消捕获注释

如果您不想再接收与备注相关的事件，例如当备注不再出现在屏幕上时，您可以删除捕获请求。

发送以下 JSON 数据：
```js
{
	type: 'unsubNote',
	body: {
		id: 'xxxxxxxxxxxxxxxx'
	}
}
```

其中
- `id` 是您要取消捕获的笔记的 ID。

发送此信息后，将不会再向您发送与该笔记相关的事件。
